## Рабочий план: хранение вопросов/ответов в PostgreSQL (Railway)

Дата и время начала: 2025-12-01T00:00:00
Исходный промт: «У нас сейчас нигде не хранятся данные в базе. Ни ответы на уже загруженные вопросы, ни вопросы без ответов. Создай план для того, чтобы реализовать. Я буду создавать PostgreSQL в railway. Учти это в плане и расскажи, что мне сделать для этого»

### Шаги работы

- [x] 1. Анализ текущей реализации БД и Alembic в backend
- [x] 2. Проектирование конфигурации PostgreSQL через DATABASE_URL
- [x] 3. Проектирование схемы таблиц questions и answers
- [x] 4. Интеграция сохранения вопросов и ответов в существующие роутеры и сервисы
- [x] 5. Подготовка миграций Alembic для новых таблиц и PostgreSQL
- [x] 6. Инструкции по настройке PostgreSQL в Railway и переменных окружения
- [x] 7. Сценарии тестирования и обновление документации

### Версионный лог

- 2025-12-01T00:00:00 — Создан рабочий план в файле PG_QA_WORKLOG.md на основе persist.plan.md, задачи ещё не начаты.
- 2025-12-01T00:10:00 — Проведён анализ `backend/app/database.py`, `backend/app/models.py`, `backend/app/schemas.py`, роутеров и `backend/migrations/env.py`; подтверждено, что используется `DATABASE_URL` и модели QAPair/Keyword уже описаны.
- 2025-12-01T00:20:00 — Уточнена конфигурация PostgreSQL: `DATABASE_URL` используется и в backend, и в Alembic; README обновлён с примером PostgreSQL строки подключения.
- 2025-12-01T00:30:00 — Добавлены модели SQLAlchemy `Question` и `Answer` и схемы Pydantic `QuestionLogResponse` и `AnswerLogResponse` для логирования вопросов и ответов.
- 2025-12-01T00:40:00 — В Slack-роутере настроено логирование вопросов и ответов в таблицы `questions` и `answers`, в админ-роутере добавлен эндпоинт `/api/log/questions`, создана первичная Alembic-миграция с таблицами `qa_pairs`, `keywords`, `questions`, `answers`.
- 2025-12-01T00:50:00 — Обновлён STATUS.md под использование PostgreSQL через `DATABASE_URL`; подготовлены инструкции по настройке Railway и миграций.
- 2025-12-01T01:00:00 — Описаны сценарии локального и продакшн-тестирования и точки диагностики через новые эндпоинты.
- 2025-12-01T01:10:00 — Создана подробная инструкция `RAILWAY_POSTGRES_SETUP.md` с учётом двух проектов на Railway (finwiki backend и finbot backend), включая шаги создания PostgreSQL, подключения к сервису, применения миграций и проверки работоспособности.
- 2025-12-01T01:20:00 — Настроено автоматическое применение миграций Alembic: создан скрипт `backend/start.sh`, обновлён `backend/Procfile` для запуска миграций перед стартом приложения, убран `Base.metadata.create_all` из `main.py` для избежания конфликтов. Теперь миграции применяются автоматически при каждом деплое на Railway без необходимости ручного запуска команд.


