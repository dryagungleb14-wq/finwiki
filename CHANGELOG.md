# Версионный лог FinWiki

## 2025-12-02 - AI-агентная архитектура

### Промпт
Переход на AI-агентную схему работы:
- AI Agent получает запрос от Slack бота
- Идет в базу знаний
- Ищет релевантные записи (может быть несколько)
- Анализирует контекст и намерение пользователя
- Синтезирует ответ с confidence score
- Если confidence < 80%, призывает менеджера

### Что сделано
- ✅ Создан файл версионного лога CHANGELOG.md
- ✅ Создан ai_agent_service.py с тремя функциями
- ✅ Реализована функция analyze_intent() - анализ вопроса и извлечение намерений
- ✅ Реализована функция synthesize_answer() - синтез ответа с confidence score
- ✅ Реализована функция process_question() - главная функция агента
- ✅ Обновлен /api/slack/search endpoint для использования AI Agent
- ✅ Интегрирован AI Agent в finbot/bot.py
- ✅ Добавлено кэширование для analyze_intent и process_question

### Завершено
- ✅ Тестирование работы системы (синтаксис проверен)
- ✅ Коммит: fa6f8e5
- ✅ Пуш в ветку claude/ai-agent-knowledge-base-016WuHZsTkDprioNTWURGUd1

### Технические детали
- Используется Gemini 2.0 Flash (free tier, 10 RPM)
- Максимум 2 вызова Gemini на вопрос:
  1. Анализ намерения и ключевых сущностей
  2. Синтез ответа из найденных записей
- Агрессивное кэширование для экономии API
- Confidence threshold: 80%
- Принципы: MVP, DRY, простой код

### Архитектура
```
Вопрос → AI Agent (анализ) → Поиск в БД → AI Agent (синтез) → Ответ + confidence
                                    ↓
                              Если < 80% → Призвать менеджера
```
