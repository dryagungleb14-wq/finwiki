# План: Исправление проблемы с ответами Slack бота

**Дата начала:** 1 декабря 2025

## Проблема

Бот отвечает, но всегда одинаковым сообщением "Ваш вопрос принят. Менеджер ответит позже." Это означает, что запросы к backend не проходят успешно.

## Причина

Сообщение "Ваш вопрос принят. Менеджер ответит позже." отправляется когда:
1. Запрос к `/api/slack/question` не проходит (timeout, ошибка соединения, неправильный статус)
2. Происходит исключение при обработке

## Что изменится после исправлений

**Сейчас:**
- Бот всегда отвечает: "Ваш вопрос принят. Менеджер ответит позже."

**После исправлений:**
- Если ответ найден в БЗ → бот отправит конкретный ответ
- Если ответа нет → бот сохранит вопрос и ответит: "Пока я не могу помочь с вашим вопросом. Но я передал его финансовому менеджеру. Пожалуйста, дождитесь ответа."
- Если backend недоступен → будет понятное сообщение об ошибке

## План исправления

- [x] Улучшить логирование — логировать URL backend при старте, детали всех запросов, ошибки соединения и timeout
- [x] Улучшить обработку ошибок — различать типы ошибок, добавить информативные сообщения
- [x] Исправить логику обработки ответов — убедиться что правильные сообщения отправляются в правильных случаях

## Версионный лог

### 2025-12-01
**Промпт:** найди причину, почему в слаке я не получаю ответов на свои вопросы. хотя мы внедрили изменения. что я делаю не так?

**Проблема:** Бот отвечает, но всегда одинаковым сообщением "Ваш вопрос принят. Менеджер ответит позже."

**Выполнено:**
- ✅ Добавлено логирование URL backend при старте бота
- ✅ Добавлено детальное логирование всех запросов к backend (URL, метод, статус, ответ)
- ✅ Улучшена обработка ошибок соединения и timeout с детальным логированием
- ✅ Разделена обработка разных типов ошибок (Timeout, ConnectionError, HTTP ошибки)
- ✅ Улучшены сообщения об ошибках для пользователей
- ✅ Исправлена логика обработки ответов — теперь правильные сообщения отправляются в правильных случаях
- ✅ Добавлена обработка ошибок парсинга JSON ответов от backend
- ✅ Добавлено логирование успешных операций (сохранение вопроса, отправка сообщений)

**Изменения в коде:**
- `finbot/bot_webhook.py` — добавлено детальное логирование и улучшена обработка ошибок

